<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="ì—¬í–‰ê³¼ ê¸°ìˆ ì„ ì—°ê²°í•˜ê³ , ì‚¬ìš©ìì™€ ì—¬í–‰ì„ ì´ì–´ì£¼ëŠ” ìŠ¤í€˜ì–´ë©ë§Œì˜ ë…¸í•˜ìš°ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.">
  <meta name="msapplication-TileColor" content="#782bde">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="-kdxteMBSgKizw-6qHNm1-5nfxb7H6947J64jmjbBEg" />

  <meta property="og:site_name" content="Square Lab ë¸”ë¡œê·¸">
  <meta property="og:title" content="K8s í´ëŸ¬ìŠ¤í„°ì— Datadog ì ìš©í•˜ê¸°">
  <meta property="og:description" content="ìŠ¤í€˜ì–´ë©ì—ì„œëŠ” ê° microservice ë³„ë¡œ ë°œìƒí•˜ëŠ” ë¡œê·¸ë“¤ì„ logstashë¥¼ í™œìš©í•˜ì—¬ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ìŒ“ì´ê²Œ ë˜ëŠ” ìˆ˜ë§ì€ ë¡œê·¸ë“¤ì„ ê´€ë¦¬í•˜ëŠ” ë¹„ìš©ì„ ì¤„ì´ê³ , ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ê³¼ ë¡œê·¸ ê´€ë¦¬ë¥¼ ë”ìš±...">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://squarelab.co/blog/datadog-poc/">
  <meta property="og:image" content="https://squarelab.co/images/blog/datadog-poc/cover.png">

  <title>K8s í´ëŸ¬ìŠ¤í„°ì— Datadog ì ìš©í•˜ê¸°</title>

  <link rel="stylesheet" type="text/css" href="/css/blog.css">
  <link rel="stylesheet" type="text/css" href="/css/footer.css">
  <link rel="stylesheet" type="text/css" href="/css/zoom.css">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href='https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css" rel="stylesheet" >

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  ì¶œì²˜: https://uxgjs.tistory.com/102 [UX ê³µì‘ì†Œ]
  <script src="/js/zoom.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XPY973PH6D"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XPY973PH6D');
  </script>
</head>
  <body>
  <header id="blog-header" class="header">
    <div class="blog-header-container">
        <a href="/blog">
          <img src="/images/squarelab-bi-blog.png" width="200" class="bi-blog" alt="ìŠ¤í€˜ì–´ë© ê¸°ìˆ ë¸”ë¡œê·¸ ë¡œê³ ">
        </a>
        <a href="/"><i class="ri-home-4-line"></i></a>
    </div>
</header>
  <div class="blog-container">
    <div class="blog-top" style="background-image:url(/images/blog/datadog-poc/datadog.png); background-size: cover;" >
        <div class="overlay">
            <div class="title-container">
                <span class="category">Engineering</span>
                <h1 class="ctitle-top">K8s í´ëŸ¬ìŠ¤í„°ì— Datadog ì ìš©í•˜ê¸°</h1>
                <div class="author">
                    <img class="img-author-2" src="/images/blog/author/seongbin.png">
                    <small class="small-top" >ì„±ë¹ˆ</small><small>|</small><small name="locale-date">Apr 24, 2023</small>
                </div>
            </div>
        </div>
    </div>
    <div class="blog-row">
        <div class="post">
            <p>ìŠ¤í€˜ì–´ë©ì—ì„œëŠ” ê° microservice ë³„ë¡œ ë°œìƒí•˜ëŠ” ë¡œê·¸ë“¤ì„ logstashë¥¼ í™œìš©í•˜ì—¬ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ìŒ“ì´ê²Œ ë˜ëŠ” ìˆ˜ë§ì€ ë¡œê·¸ë“¤ì„ ê´€ë¦¬í•˜ëŠ” ë¹„ìš©ì„ ì¤„ì´ê³ , ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ê³¼ ë¡œê·¸ ê´€ë¦¬ë¥¼ ë”ìš± í¸ë¦¬í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤ëŠ” ê¸°ëŒ€ë¥¼ ê°–ê³  Datadogì„ ì ìš©í•´ë³´ëŠ” PoC ê¸°ê°„ì„ ê°–ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ê¸€ì€ Datadog ì—°ë™ì— ëŒ€í•œ ê´€ì‹¬ì´ ìˆìœ¼ì‹  ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<h2 id="datadog-ì ìš©-ê³¼ì •">Datadog ì ìš© ê³¼ì •</h2>
<p>K8s í´ëŸ¬ìŠ¤í„°ì— Datadogì„ ì ìš©í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ì´ ì„¸ ë‹¨ê³„ë¡œ ìš”ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Helm chart install â†’ Deployment tagging / í™˜ê²½ë³€ìˆ˜ ì£¼ì… â†’ ì¬ë°°í¬</p>

<p>prd í™˜ê²½ì— ì ìš©í•˜ê¸° ìœ„í•œ ì¤€ë¹„ ë‹¨ê³„ë¡œ, ë¨¼ì € dev í™˜ê²½ì— Datadogì„ ì ìš©í•´ë³´ì•˜ìŠµë‹ˆë‹¤.
devì™€ prd clusterì—ì„œ ê°ê° <code class="highlighter-rouge">values-dev.yaml</code> / <code class="highlighter-rouge">values-prd.yaml</code> ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p>

<h3 id="datadog-helm-chart-install">Datadog helm chart Install</h3>
<p><code class="highlighter-rouge">helm install</code>ì´ ì„±ê³µì ìœ¼ë¡œ ë§ˆë¬´ë¦¬ ë˜ë©´, datadog-cluster ê°€ ìƒì„±ë˜ê³ , k8s clusterì˜ ê° ë…¸ë“œë³„ë¡œ Datadog agent podì´ í•˜ë‚˜ì”© ìƒì„±ë˜ê²Œ ë©ë‹ˆë‹¤.
<a href="https://github.com/DataDog/helm-charts/blob/main/charts/datadog/values.yaml">ì—¬ê¸°</a>ì—ì„œ values.yamlì˜ default ê°’ì„ ì°¸ê³ í•˜ì—¬, í•„ìš”í•œ ë¶€ë¶„ë§Œ ê³¨ë¼ì„œ yaml íŒŒì¼ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
ì²˜ìŒ ì ìš© ê³¼ì •ì—ì„œ ì–´ë–¤ ì˜µì…˜ì´ í•„ìš”í•œì§€ íŒë‹¨í•˜ê¸°ê°€ ì–´ë ¤ì›Œ ë§ì€ ì‹œí–‰ì°©ì˜¤ë¥¼ ê±°ì³¤ê³ , ì´ ê³¼ì •ì—ì„œ ê²ªì€ ì‹œí–‰ì°©ì˜¤ë“¤ê³¼, ì²˜ìŒ Datadogì„ ì ìš©í•´ë³´ë ¤ëŠ” ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë  ë§Œí•œ ë‚´ìš©ë“¤ì„ ì†Œê°œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<hr />

<h3 id="1-agent-version-ë¶ˆì¼ì¹˜">1. Agent version ë¶ˆì¼ì¹˜</h3>
<p>ì²˜ìŒì—ëŠ” <code class="highlighter-rouge">values.yaml</code> íŒŒì¼ ë‚´ì— <code class="highlighter-rouge">clusterName</code> ë“± í•„ìˆ˜ ê°’ê³¼ ì‚¬ìš©í•  ê¸°ëŠ¥ë“¤ì„ <code class="highlighter-rouge">enable: true</code>ë¡œ ì„¤ì •í•œ í›„, Datadogìœ¼ë¡œë¶€í„° ë°œê¸‰ë°›ì€ apiKeyì™€ í•¨ê»˜ <code class="highlighter-rouge">helm install</code> ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p>

<p>ì´ ë•Œ ì•„ë˜ì™€ ê°™ì€ errorê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: INSTALLATION FAILED: execution error at (datadog/templates/_helpers.tpl:17:4): This version of the chart requires an agent image 7.36.0 or greater. If you want to force and skip this check, use `--set agents.image.doNotCheckTag=true`
</code></pre></div></div>
<p>ë‹¹ì‹œ <code class="highlighter-rouge">values.yaml</code> ë‚´ì— <code class="highlighter-rouge">tag</code> ë¥¼ ì„¤ì •í•´ì£¼ì§€ ì•Šì•„ì„œ ë°œìƒí–ˆë˜ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.
<code class="highlighter-rouge">clusterAgent.image.tag</code> / <code class="highlighter-rouge">agents.image.tag</code> / <code class="highlighter-rouge">clusterChecksRunner.image.tags</code> ì— ë™ì¼í•œ ê°’ì„ ì…ë ¥í•˜ì—¬ í•´ê²°í–ˆìŠµë‹ˆë‹¤.</p>

<hr />

<h3 id="2-env-ì£¼ì…--labelling">2. env ì£¼ì… / labelling</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/tracing/other_telemetry/connect_logs_and_traces/nodejs/">Connecting Node.js Logs and Traces</a>
<a href="https://docs.datadoghq.com/tracing/trace_collection/library_config/nodejs/">Configuring the Node.js Tracing Library</a></p>
</blockquote>

<ol>
  <li>ê° ì„œë¹„ìŠ¤ë³„ë¡œ <code class="highlighter-rouge">DD_LOGS_INJECTION</code> í™˜ê²½ë³€ìˆ˜ê°€ ì£¼ì…ë˜ë©´ Datadogì€ consoleë¡œ print ë˜ëŠ” ë¡œê·¸ë“¤ì„ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</li>
  <li>ë³„ë„ì˜ ì„¤ì • ì—†ì´ë„ ì„œë¹„ìŠ¤ì˜ env, service, versionì„ ìë™ìœ¼ë¡œ ë°œê²¬í•©ë‹ˆë‹¤.
 Nodeì˜ ê²½ìš°ì—ëŠ” <code class="highlighter-rouge">package.json</code> ë‚´ì— ìˆëŠ” ê°’ì„ ì°¸ê³ í•˜ê²Œ ë˜ëŠ”ë°, ì´ ê°’ì„ <code class="highlighter-rouge">package.json</code> ì—ì„œ ê´€ë¦¬í•  ìˆ˜ë„ ìˆì§€ë§Œ, <code class="highlighter-rouge">env</code>ì˜ ê²½ìš°ëŠ” clusterë§ˆë‹¤(ë˜ëŠ” namespaceë§ˆë‹¤) <code class="highlighter-rouge">version</code>ì˜ ê²½ìš°ì—ëŠ” deploymentê°€ ë°°í¬ë  ë•Œë§ˆë‹¤ ë³€ê²½ë˜ì–´ì•¼í•˜ë¯€ë¡œ ì„œë¹„ìŠ¤ë³„ yaml íŒŒì¼ì˜ metadata ë¶€ë¶„ì— ê°’ì„ ì§€ì •í•´ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í¸ë¦¬í–ˆìŠµë‹ˆë‹¤.</li>
  <li>annotations ì—ì„œ JS ì„œë¹„ìŠ¤ì¸ì§€, Java ì„œë¹„ìŠ¤ì¸ì§€ì— ì•Œë§ê²Œ libraryë¥¼ ì§€ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.
í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ yaml íŒŒì¼ì´ ìˆ˜ì •ë˜ì—ˆì„ ë•Œ, deploymentë¥¼ ì¬ì‹œì‘í•˜ì—¬ ë°˜ì˜ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ì´ ë•Œ ê° podì˜ <code class="highlighter-rouge">datadog-lib-init</code> containerê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰/ì¢…ë£Œ ë˜ì—ˆì–´ì•¼í•©ë‹ˆë‹¤.</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deployment-name</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">tags.datadoghq.com/env</span><span class="err">:</span> <span class="s">${ENV}</span> <span class="c1"># dev | qa | rc | prd</span>
    <span class="na">tags.datadoghq.com/service</span><span class="pi">:</span> <span class="s">service-name</span>
    <span class="na">tags.datadoghq.com/version</span><span class="pi">:</span> <span class="s">${VERSION}</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">template</span><span class="err">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="s">...</span>
        <span class="s">admission.datadoghq.com/js-lib.version</span><span class="err">:</span> <span class="s">v0.00.0</span>
        <span class="s"># or admission.datadoghq.com/java-lib.version</span><span class="err">:</span> <span class="s">v0.00.0</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">service-name</span>
          <span class="s">...</span>
          <span class="na">env</span><span class="pi">:</span>
              <span class="s">...</span>
            <span class="s">- name</span><span class="err">:</span> <span class="s">DD_LOGS_INJECTION</span>
              <span class="s">value</span><span class="err">:</span> <span class="s1">'</span><span class="s">true'</span>
</code></pre></div></div>

<hr />

<h3 id="3-ë¶ˆí•„ìš”í•œ-logë“¤ì„-indexing-ëŒ€ìƒì—ì„œ-ì œì™¸í•˜ê¸°">3. ë¶ˆí•„ìš”í•œ logë“¤ì„ indexing ëŒ€ìƒì—ì„œ ì œì™¸í•˜ê¸°</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/logs/explorer/search_syntax/">Log Search Syntax</a></p>
</blockquote>

<p>health check ì™€ ê°™ì´ ì£¼ê¸°ì ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” logë“¤ì€ status levelì´ infoê°€ ì•„ë‹ ê²½ìš°ì—ë§Œ ìˆ˜ì§‘í•˜ë„ë¡  indexing ëŒ€ìƒì—ì„œ ì œì™¸í•˜ë©´ ìš”ê¸ˆì„ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="/images/blog/datadog-poc/log_indexes.png" alt="Log Indexes" />
ìœ„ ì´ë¯¸ì§€ëŠ” Logs - Configuration - Indexesì—ì„œ kube_namespaceê°€ dev / qa / rc / default(prd) ì¼ ë•Œ health check filtering í•˜ëŠ” ë¶€ë¶„ë§Œ ë‚˜íƒ€ëƒˆìŠµë‹ˆë‹¤. ìœ„ì™€ ê°™ì´ ì‚¬ì§„ê³¼ ê°™ì´ í•„í„°ë¥¼ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„í„°ëŠ” ìƒë‹¨ì—ì„œ í•˜ë‹¨ë¶€ë¡œ ë‚´ë ¤ê°€ë©´ì„œ ì°¨ë¡€ëŒ€ë¡œ ì ìš©ë˜ë©°, í•œë²ˆ filter ëœ LogëŠ” í•˜ìœ„ í•„í„°ì—ì„œ ë°œê²¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ìƒìœ„ í•„í„°ì—ì„œ ë„ˆë¬´ ë²”ìš©ì ì¸ ì¡°ê±´ì„ ê±¸ë©´ í•˜ìœ„ í•„í„°ì—ì„œ í•´ë‹¹ ë‚´ìš©ì„ ì²˜ë¦¬í•  ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.
<img src="/images/blog/datadog-poc/log_indexing_exclusion_filter.png" alt="Log Exclusion Filter" />
ì´ ë•Œ, Exclusion Filterì—ì„œëŠ” í•´ë‹¹ í•„í„° ì¡°ê±´ì— ë§ëŠ” ë¡œê·¸ë“¤ì„ ì œì™¸ì‹œí‚¤ê¸° ë•Œë¬¸ì— execlusion operator(<code class="highlighter-rouge">-</code>)ë¥¼ ì‚¬ìš©í•˜ë©´ ì˜¤íˆë ¤ indexing ëŒ€ìƒì´ ë©ë‹ˆë‹¤. Datadogì—ì„œëŠ” case sensitive í•˜ê²Œ query í•˜ê¸° ë•Œë¬¸ì—, ìœ„ ì´ë¯¸ì§€ì˜ exclusion query ë¶€ë¶„ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë“¯, uripathê°€ <code class="highlighter-rouge">health/Check</code> ì™€ <code class="highlighter-rouge">Health/check</code> ì¸ ê²½ìš°ë¥¼ ëª¨ë‘ ê³ ë ¤í•  ìˆ˜ ìˆì–´ì•¼í–ˆìŠµë‹ˆë‹¤. <code class="highlighter-rouge">*</code> ë¥¼ ì‚¬ìš©í•´ì„œ ì¼ë¶€ë¶„ì„ matching ì‹œí‚¬ ìˆ˜ëŠ” ìˆì§€ë§Œ, ì •ê·œì‹ì˜ case insensitive ì˜µì…˜ì„ ì£¼ë“¯ì´ í•  ìˆ˜ëŠ” ì—†ì—ˆìŠµë‹ˆë‹¤. ìœ„ì˜ exclusion queryì—ì„œ health check filtering ë¶€ë¶„ì€ <code class="highlighter-rouge">?</code> ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ê±´ì„ <code class="highlighter-rouge">*?ealth/?heck</code> ì™€ ê°™ì´ ì„¤ì •í•  ìˆ˜ë„ ìˆê² ì§€ë§Œ, ì¶”í›„ì— ì•Œì•„ë³´ê¸°ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ ê°ê°ì˜ caseë¥¼ ëª¨ë‘ ì„¤ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. <code class="highlighter-rouge">*[hH]ealth/[cC]heck</code> ì™€ ê°™ì€ í˜•íƒœì˜ ì •ê·œì‹ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ì§€ë§Œ, ì•„ì‰½ê²Œë„ search query ë‚´ë¶€ì—ì„œëŠ” ì´ëŸ° ì •ê·œì‹ì´ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p>Logs - Searchì—ì„œëŠ” ì—¬ê¸°ì„œ ì„¤ì •í•œ <code class="highlighter-rouge">index</code> ê·¸ë£¹ë³„ë¡œ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<hr />

<h3 id="4-log-pipeline">4. Log pipeline</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/agent/logs/advanced_log_collection/?tab=configurationfile#global-processing-rules">Global processing rules</a></p>
</blockquote>

<p>Datadogì€ ê¸°ë³¸ì ìœ¼ë¡œ consoleì— ì¶œë ¥ë˜ëŠ” ë¡œê·¸ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤. ê¸°ì¡´ì— Filebeatì—ì„œ ì‚¬ìš©í•˜ë˜ ê·œì¹™ì„ ê·¸ëŒ€ë¡œ datadog pipelineìœ¼ë¡œ ì˜®ê¸°ê¸° ìœ„í•´ì„œëŠ”, ë¡œê·¸ë‚´ì˜ ì •ë³´ë¥¼ ì¡°í•©í•´ì„œ ìƒˆë¡œìš´ attributeë¥¼ ë§Œë“¤ê±°ë‚˜, JSON í˜•ì‹ì´ ì•„ë‹Œ ë¡œê·¸ì— ëŒ€í•´ì„œëŠ” <code class="highlighter-rouge">parser ì ìš©</code> â¡ï¸ <code class="highlighter-rouge">remapper ì ìš©</code> ê³¼ì •ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>
    <p>ì„œë¹„ìŠ¤ë³„ë¡œ ì‚¬ìš©í•˜ê³  ìˆëŠ” loggerì˜ ì¢…ë¥˜ì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ remapperë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì£¼ì–´ì•¼í–ˆìŠµë‹ˆë‹¤.
<img src="/images/blog/datadog-poc/log_pipeline.png" alt="Log Pipeline" /></p>
  </li>
  <li>ë¡œê·¸ì˜ dateê°€ Datadogì—ì„œ ì²˜ë¦¬ëœ ì‹œì ìœ¼ë¡œ ê¸°ë¡ë˜ì–´ì„œ, ì ì ˆí•œ ì‹œê°„ëŒ€ê°€ ê¸°ë¡ë˜ì§€ ì•Šê³  ìˆœì„œê°€ ì—‰í‚¤ëŠ” ê²½ìš°ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. <code class="highlighter-rouge">Date Remapper</code>ë¥¼ ì‚¬ìš©í•´ì„œ í•´ë‹¹ ë¡œê·¸ì— ê¸°ë¡ë˜ì–´ìˆëŠ” ì‹œê°„ì„ dateë¡œ ì‚¬ìš©í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</li>
  <li>ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆëŠ” <code class="highlighter-rouge">grpc status code</code>ë¥¼ Datadogì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” level(<code class="highlighter-rouge">INFO</code> / <code class="highlighter-rouge">WARN</code> / <code class="highlighter-rouge">ERROR</code>)ë¡œ ë³€í˜•ì‹œí‚¤ê¸° ìœ„í•´ì„œ <code class="highlighter-rouge">Lookup Processor</code> â¡ï¸ <code class="highlighter-rouge">Status Remapper</code> ë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤.</li>
  <li>JSON í˜•íƒœê°€ ì•„ë‹ˆë¼, stringìœ¼ë¡œ ì¶œë ¥ë˜ëŠ” ë¡œê·¸ì˜ ê²½ìš° Levelì´ <code class="highlighter-rouge">INFO</code> ë˜ëŠ” <code class="highlighter-rouge">WARN</code>ì´ì–´ì•¼í•˜ì§€ë§Œ <code class="highlighter-rouge">ERROR</code>ë¡œ ì„¤ì •ë˜ê±°ë‚˜ ë˜ëŠ” ê·¸ ë°˜ëŒ€ë¡œ ì ìš©ë˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì´  ë•ŒëŠ” <code class="highlighter-rouge">Grok Parser</code> â¡ï¸ <code class="highlighter-rouge">Status Remapper</code> ë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì´ë¯¸ì§€ëŠ” error level ì¡°ì • ì „ì— <code class="highlighter-rouge">INFO</code> ì—¬ì•¼í•  logë“¤ì´ <code class="highlighter-rouge">ERROR</code>ë¡œ ì²˜ë¦¬ë˜ë‹¤ê°€ Remapping ì ìš© í›„ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ê³  ìˆëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.
  <img src="/images/blog/datadog-poc/log_search_status.png" alt="Log Status" /></li>
</ul>

<p>ëª¨ë“  ë¡œê·¸ë¥¼ ì´ë ‡ê²Œ UI ìƒì—ì„œ í•„í„°ë§ í•´ì•¼í•˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. yaml íŒŒì¼ ë‚´ë¶€ì— <code class="highlighter-rouge">exclude_at_match</code> ë˜ëŠ” <code class="highlighter-rouge">include_at_match</code> ì— ì •ê·œì‹ íŒ¨í„´ì„ ì‘ì„±í•˜ì—¬ Datadogìœ¼ë¡œ ì „ì†¡ë˜ì§€ ì•Šë„ë¡ global processing ruleì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë‹¤ë§Œ, json í˜•íƒœì˜ ë¡œê·¸ì—ì„œ ì •ê·œì‹ìœ¼ë¡œ ë‹¤ì–‘í•œ AND / OR ì¡°ê±´ì„ ê±°ëŠ” ê²ƒì€ ê²½ì œì ì´ì§€ ëª»í•˜ê³ , Datadogì—ì„œë„ ì €ì¥ë˜ëŠ” ë¡œê·¸ì˜ ì–‘ìœ¼ë¡œ ë¹„ìš©ì„ ê³„ì‚°í•˜ê¸° ë•Œë¬¸ì— UI ìƒì—ì„œ pipelineê³¼ filtering ì¡°ê±´ì„ ê±°ëŠ” ê²ƒì´ ë‚«ê² ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.</p>

<hr />

<h3 id="5-apm-tracing-ëŒ€ìƒì—ì„œ-ì œì™¸í•˜ê¸°">5. APM tracing ëŒ€ìƒì—ì„œ ì œì™¸í•˜ê¸°</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/tracing/guide/ignoring_apm_resources/?tab=datadogyaml#trace-agent-configuration-options">Trace Agent configuration options</a></p>
</blockquote>

<p>Health check ì™€ ê°™ì€ ë‚´ìš©ë“¤ì€ ë¡œê·¸ indexingì€ í•´ì•¼í•˜ì§€ë§Œ, trace ëŒ€ìƒì—ì„œëŠ” ì œì™¸í•˜ëŠ” ê²ƒì´ ë§ê²Œë‹¤ê³  íŒë‹¨í•˜ì—¬ resourceë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì™„ì „íˆ ì œì™¸í–ˆìŠµë‹ˆë‹¤.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">datadog</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">agents</span><span class="err">:</span>
    <span class="s">...</span>
    <span class="s">containers</span><span class="err">:</span>
      <span class="na">traceAgent</span><span class="pi">:</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DD_APM_IGNORE_RESOURCES</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s">(?i)grpc\\.health\\.v1\\.Health\\/Check$</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">DD_APM_FILTER_TAGS_REQUIRE</code> / <code class="highlighter-rouge">DD_APM_FILTER_TAGS_REJECT</code> í™˜ê²½ë³€ìˆ˜ë¥¼ ë¶€ì—¬í•´ì„œ apm ëŒ€ìƒì—ì„œ í¬í•¨í•˜ê±°ë‚˜ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, ê° ì¡°ê±´ë“¤ì€ ORë¡œ ë¬¶ì´ê³  ì •ê·œì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
<code class="highlighter-rouge">DD_APM_IGNORE_RESOURCES</code> í™˜ê²½ë³€ìˆ˜ëŠ” resourceë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ê·œì‹ì„ ì ìš©í•  ìˆ˜ ìˆì–´ì„œ Health check ëŒ€ìƒì—ì„œ ìœ„ì™€ ê°™ì´ ì œì™¸í–ˆìŠµë‹ˆë‹¤.</p>

<hr />

<h3 id="6-secretbackend">6. secretBackend</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/agent/guide/secrets-management/?tab=linux#script-for-reading-from-multiple-secret-providers">Script for reading from multiple secret providers</a></p>
</blockquote>

<p>k8s deployment yaml íŒŒì¼ì„ ì‘ì„±í•˜ë“¯, Datadog helm chartë¥¼ install í•  ë•Œì—ë„ í´ëŸ¬ìŠ¤í„°ì— ì…ë ¥ë˜ì–´ìˆëŠ” secret ê°’ì„ ì°¸ê³ í•˜ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ Datadogì—ì„œëŠ” secretBackendë¥¼ ì œê³µí•©ë‹ˆë‹¤.
Datadog apiKey ì˜ ê²½ìš°, <code class="highlighter-rouge">helm chart install / upgrade</code> ì‹œ ë§¤ë²ˆ ì…ë ¥í•˜ê±°ë‚˜ í•´ë‹¹ ê°’ì„ ê·¸ëŒ€ë¡œ íŒŒì¼ ë‚´ì— ì…ë ¥í•´ë†“ê¸°ë³´ë‹¤ëŠ” secret ê°’ì„ ì°¸ì¡°í•˜ë„ë¡ í•˜ë©´ ì•ˆì „í•˜ê²Œ ê°’ì„ ê´€ë¦¬í•  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p>

<p>ì•„ë˜ì™€ ê°™ì´ secretì„ ìƒì„±í–ˆë‹¤ë©´,</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create secret generic datadog-secret <span class="nt">--from-literal</span> api-key<span class="o">=</span><span class="s2">"api key from datadog"</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">values-dev.yaml</code>  ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ secretBackend commandë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼í•˜ë©°, ì´ë¡œ ì¸í•´ <code class="highlighter-rouge">ENC</code> íƒœê·¸ë¡œ ë‘˜ëŸ¬ìŒ“ì—¬ìˆëŠ” ë¶€ë¶„ì´ ë³€í™˜ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">datadog</span><span class="pi">:</span>
  <span class="na">apiKey</span><span class="pi">:</span> <span class="s">ENC[k8s_secret@dev/datadog-secret/api-key]</span>
  <span class="na">secretBackend</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/readsecret_multiple_providers.sh'</span>
</code></pre></div></div>

<hr />

<h3 id="7-db-monitoring">7. DB Monitoring</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/database_monitoring/setup_mysql/rds/?tab=mysql57">Setting Up Database Monitoring for Amazon RDS managed MySQL</a>
<a href="https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html">Amazon RDS DB ì¸ìŠ¤í„´ìŠ¤ ìˆ˜ì •</a></p>
</blockquote>

<p>DB Monitoringì„ ì ìš©í•  ë•Œì—ë„, <code class="highlighter-rouge">ENC</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ secret ì„ ì°¸ì¡°í•˜ë„ë¡ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">datadog</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">clusterAgent</span><span class="err">:</span>
    <span class="s">...</span>
    <span class="s">confd</span><span class="err">:</span>
      <span class="na">mysql.yaml</span><span class="pi">:</span> <span class="pi">|-</span>
        <span class="s">cluster_check: true</span>
        <span class="s">init_config:</span>
        <span class="s">instances:</span>
          <span class="s">- dbm: true</span>
            <span class="s">host: ENC[k8s_secret@namespace/dbm-cred/host]</span>
            <span class="s">port: ENC[k8s_secret@namespace/dbm-cred/port]</span>
            <span class="s">username: ENC[k8s_secret@namespace/dbm-cred/username]</span>
            <span class="s">password: ENC[k8s_secret@namespace/dbm-cred/password]</span>
</code></pre></div></div>

<p>DBM ì„¤ì • ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
DB parameter ì„¤ì • â¡ï¸ datadog ê³„ì • ìƒì„± / ê¶Œí•œ ë¶€ì—¬ â¡ï¸ Agent ì„¤ì¹˜ â¡ï¸ (optional) Datadog RDS Integration</p>

<p>Datadog ê³„ì •ì„ ìƒì„±í•˜ê³ , Agent ì„¤ì¹˜ê¹Œì§€ ì™„ë£Œí–ˆìœ¼ë‚˜, DB Monitoringì´ í™œì„±í™”ë˜ì§€ ì•ŠëŠ” ì´ìŠˆê°€ ìˆì—ˆìŠµë‹ˆë‹¤. agent ë‚´ì— dbm ì„¤ì •ì´ ì œëŒ€ë¡œ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ”, node ë³„ë¡œ ìƒì„±ëœ datadog-agent podë“¤ ì¤‘ í•˜ë‚˜ì—ì„œ <code class="highlighter-rouge">agent check mysql</code> ë¥¼ ì‹¤í–‰í•´ë³´ëŠ” ê²ƒì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ì´ ë•Œ í•´ë‹¹ ëª…ë ¹ì–´ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” podì€ ëœë¤ìœ¼ë¡œ ì§€ì •ë˜ì–´ì„œ ë¶ˆí¸í•œ ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p><code class="highlighter-rouge">agent check mysql</code> ì„ ì‹¤í–‰í•´ë³´ë‹ˆ ì•„ë˜ì™€ ê°™ì€ Warningì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=========
Collector
=========
  Running Checks
  ==============
    mysql (x.x.x)
    --------------
      Instance ID: mysql:xxx [WARNING]
      Configuration Source: file:/etc/xxx/conf.d/mysql.yaml
      Total Runs: 1
      Metric Samples: Last Run: 88, Total: 88
      Events: Last Run: 0, Total: 0
      Service Checks: Last Run: 3, Total: 3
      Average Execution Time : 97ms
      Last Execution Date : 2023-03-30 06:47:33 UTC (1680158853000)
      Last Successful Execution Date : 2023-03-30 06:47:33 UTC (1680158853000)

      Warning: Unable to collect statement metrics because the performance schema is disabled. See &lt;https://docs.datadoghq.com/database_monitoring/setup_mysql/troubleshooting#performance-schema-not-enabled&gt; for more details
code=performance-schema-not-enabled host=&lt;RDS_HOST&gt;

      Warning: Query activity and wait event collection is disabled on this host. To enable it, the setup consumer `performance-schema-consumer-events-waits-current` must be enabled on the MySQL server. Please refer to the troubleshooting documentation: &lt;https://docs.datadoghq.com/database_monitoring/setup_mysql/troubleshooting#events-waits-current-not-enabled&gt;
code=events-waits-current-not-enabled host=&lt;RDS_HOST&gt;
</code></pre></div></div>

<p>ë¬¸ì œëŠ” DB parameterê°€ RDS ìƒì—ì„œ default mysql ê°’ìœ¼ë¡œ ì§€ì •ë˜ì–´ìˆë‹¤ë³´ë‹ˆ, <code class="highlighter-rouge">performance_schema</code> ê°’ì´ 0ìœ¼ë¡œ ë˜ì–´ìˆë˜ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. <code class="highlighter-rouge">max_digest_length</code> / <code class="highlighter-rouge">performance_schema_max_diget_length</code> / <code class="highlighter-rouge">performance_schema_max_sql_text_length</code> ê°’ë“¤ë„ 4096 ìœ¼ë¡œ ì„¤ì •ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ì´í›„ íŒŒë¼ë¯¸í„° ê·¸ë£¹ì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” DBë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¬ì‹œì‘í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.</p>

<p><img src="/images/blog/datadog-poc/dbm_success.png" alt="DBM install success" />
DBë¥¼ ì¬ì‹œì‘ í•˜ê³  ë‚œ ë’¤, Database Monitoringì´ ì„±ê³µì ìœ¼ë¡œ set up ë˜ì—ˆë‹¤ëŠ” ê¸°ìœ ë©”ì‹œì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<hr />

<h3 id="8-kotlin-ì„œë¹„ìŠ¤ì˜-ì¼ë¶€ê°€-apm-catalog-ëª©ë¡ì—-ëœ¨ì§€-ì•ŠëŠ”-ê²½ìš°">8. Kotlin ì„œë¹„ìŠ¤ì˜ ì¼ë¶€ê°€ APM catalog ëª©ë¡ì— ëœ¨ì§€ ì•ŠëŠ” ê²½ìš°</h3>
<p>Kotlinìœ¼ë¡œ ì‘ì„±í•œ í”„ë¡œì íŠ¸ë“¤ ì¤‘ ì¼ë¶€ëŠ” APM ëª©ë¡ì—ì„œ í™•ì¸í•  ìˆ˜ê°€ ì—†ì—ˆê³ , í•´ë‹¹ ì—ëŸ¬ëŠ” socket ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í–ˆë‹¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
<img src="/images/blog/datadog-poc/socket_not_found.png" alt="Socket Not Found Error" />
ê·¸ëŸ¬ë‚˜ podì— ì§ì ‘ ì ‘ì†í•˜ì—¬ í•´ë‹¹ ê²½ë¡œë¥¼ í™•ì¸í•´ë³´ë©´, <code class="highlighter-rouge">dsd.socket</code> ì€ í•´ë‹¹ ê²½ë¡œì— ì¡´ì¬í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p>ë¬¸ì œê°€ ë˜ëŠ” ì„œë¹„ìŠ¤ë“¤ì˜ í™˜ê²½ë³€ìˆ˜ì— ì•„ë˜ì™€ ê°™ì´ <code class="highlighter-rouge">DD_DOGSTATSD_SOCKET</code> ì„ ì¶”ê°€í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- name: DD_DOGSTATSD_SOCKET
  value: <span class="s1">'/var/run/datadog/dsd.socket'</span>
</code></pre></div></div>

<p>ê·¸ í›„, podì„ ì¬ì‹œì‘í–ˆì„ ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì´ <code class="highlighter-rouge">dsd.socket</code> ì„ Detect í–ˆë‹¤ëŠ” ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê³ , í•´ë‹¹ ì„œë¹„ìŠ¤ë¥¼ APM ëª©ë¡ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
<img src="/images/blog/datadog-poc/socket_found.png" alt="Socket Found" /></p>

<p>ì¦‰, socket ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í•´ì„œ ë°œìƒí•˜ëŠ” ë²„ê·¸ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.</p>

<hr />

<h3 id="9-trace-idê°€-ì œëŒ€ë¡œ-ì—°ê²°ë˜ì§€-ì•ŠìŒ">9. Trace IDê°€ ì œëŒ€ë¡œ ì—°ê²°ë˜ì§€ ì•ŠìŒ</h3>
<blockquote>
  <p><a href="https://docs.datadoghq.com/tracing/trace_collection/open_standards/java/#opentracing">OpenTracing</a></p>
</blockquote>

<p><img src="/images/blog/datadog-poc/trace.png" alt="Traces" />
<img src="/images/blog/datadog-poc/trace_divided.png" alt="Trace Devided" />
Node.JS ì„œë¹„ìŠ¤ë“¤ì—ì„œëŠ” ì˜ ì‘ë™í•˜ì§€ë§Œ, Node â¡ï¸ Kotlin í”„ë¡œì íŠ¸ë¡œ grpc request ê°€ ì§„í–‰ë  ë•Œ, <code class="highlighter-rouge">trace id</code> ê°€ ì´ì–´ì§€ì§€ ì•Šê³  ìƒˆë¡œìš´ <code class="highlighter-rouge">trace_id</code>ê°€ ë¶€ì—¬ë˜ì–´ì„œ ë³„ë„ì˜ spanì´ ìƒê¸°ëŠ” ê²½ìš°ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p>ê¸°ì¡´ì—ëŠ” loggingì‹œ headerì— <code class="highlighter-rouge">request_id</code> ì •ë³´ê°€ ìˆìœ¼ë©´ í•´ë‹¹ <code class="highlighter-rouge">request_id</code> ë¥¼ ë‹¤ìŒ requestë¡œ ê°€ì ¸ê°€ê³ , í•´ë‹¹ ì •ë³´ê°€ ì—†ìœ¼ë©´ ìƒˆë¡­ê²Œ ë°œê¸‰í•˜ì—¬ logë“¤ ê°„ tracingì„ í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
APM trace ê¸°ëŠ¥ì´ ì œëŒ€ë¡œ ë™ì‘í•œë‹¤ë©´, í¸ë¦¬í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ìƒí™©ì´ì—ˆê¸°ì—, Log Pipelineì—ì„œ <code class="highlighter-rouge">Trace ID Remapper</code> ë¥¼ ì‚¬ìš©í•˜ë©´ ê°„ë‹¨í•˜ê²Œ ì ìš©ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒí–ˆì—ˆìŠµë‹ˆë‹¤.</p>

<p>ê·¸ëŸ¬ë‚˜ Remapperë¥¼ ì ìš©í•˜ë©´ Log - Searchì—ì„œëŠ” <code class="highlighter-rouge">trace_id</code> attributeê°€ <code class="highlighter-rouge">request_id</code>ë¡œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì§€ë§Œ, APMì—ì„œëŠ” <code class="highlighter-rouge">trace_id</code> ê°€ ê·¸ëŒ€ë¡œ <code class="highlighter-rouge">64 bits unsigned int</code> í˜•íƒœë¡œ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤.</p>

<p>Java ê³„ì—´ì˜ ì„œë¹„ìŠ¤ëŠ” <code class="highlighter-rouge">mdc</code> ë‚´ë¶€ì— <code class="highlighter-rouge">dd.trace_id</code> ê°€ ì£¼ì…ë˜ê³  ìˆì–´ì„œ Log - Configurationì˜ <code class="highlighter-rouge">Preprocessing for JSON logs</code> ë‹¨ê³„ì—ì„œ <code class="highlighter-rouge">Trace Id attributes</code> ì„¤ì •ì— <code class="highlighter-rouge">mdc.dd.trace_id</code> ë¥¼ ì¶”ê°€í•´ì•¼í–ˆìŠµë‹ˆë‹¤.</p>

<p>Datadog ì¸¡ìœ¼ë¡œë¶€í„° í˜„ì¬ Node.JSì™€ Kotlinì˜ Frameworkë¥¼ ì•„ì§ ì§€ì›í•˜ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— auto instrumentationì´ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•ŠëŠ” í˜„ìƒìœ¼ë¡œ í™•ì¸í•˜ì˜€ê³ , ì½”ë“œ ë‹¨ì—ì„œ header ì •ë³´ë¥¼ Node.JSì—ì„œ ì¶”ì¶œí•˜ì—¬ Kotlin(Java)ë¡œ ì£¼ì…í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´ë°›ì•˜ìŠµë‹ˆë‹¤.</p>

<p><a href="https://github.com/DataDog/dd-trace-java/releases">Datadog java trace GitHub repository</a>ì—ì„œ ì¦ì€ releaseê°€ ì¼ì–´ë‚˜ê³  ìˆìŠµë‹ˆë‹¤. ì–´ì©Œë©´ ì½”ë“œ ë‚´ë¶€ë¡œ tracingê´€ë ¨ ì½”ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ ë³´ë‹¤ëŠ” auto instrumentationì´ ì˜ ì‘ë™í•˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê±°ë‚˜ í•´ë‹¹ Repositoryì— ì§ì ‘ ê¸°ì—¬í•˜ëŠ” ê²ƒì´ ë‚˜ì„ ìˆ˜ë„ ìˆê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬</h2>
<p>Datadog helm chart installì‹œì˜ ì„¤ì •ë§Œ ì œëŒ€ë¡œ í•´ì¤€ë‹¤ë©´, k8s í™˜ê²½ì—ì„œ Datadogì„ ì ìš©í•˜ëŠ” ê²ƒì€ ê½¤ë‚˜ í¸ë¦¬í–ˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì— logstashìƒì—ì„œ ë¡œê·¸ë¥¼ ê²€ìƒ‰í•˜ë©´ì„œ ê²ªì—ˆë˜ ë¶ˆí¸í•¨ì€ Datadogì„ ì‚¬ìš©í•˜ë©´ì„œ ì–´ëŠì •ë„ í•´ì†Œë  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ë³„ monitorë‚˜ dashboardë„ í™•ì¸í•˜ê¸° í¸ë¦¬í•˜ì—¬, íŠ¸ë˜í”½ì´ ëª°ë¦¬ëŠ” ì‹œì ì— ëŒ€ë¹„í•˜ì—¬ deploymentì˜ scale outì„ ì§„í–‰í•  ë•Œ ëª¨ë‹ˆí„°ë§ í•˜ê¸°ì—ë„ ìœ ìš©í–ˆìŠµë‹ˆë‹¤.
ë¹„ìš©ê³¼ ì‚¬ìš©ì„±ì„ ê³ ë ¤í•˜ì—¬ dev clusterì—ì„œëŠ” log indexingê¸°ëŠ¥ë§Œ ì‚¬ìš©í•˜ê³ , prdì—ì„œëŠ” APMì´ë‚˜ DB monitoringê¹Œì§€ ì ìš©í•´ì„œ ì‚¬ìš©í•œë‹¤ë©´ í›¨ì”¬ ê²½ì œì ìœ¼ë¡œ logë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.</p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, PoC ê¸°ê°„ ë™ì•ˆ ë§ì€ ë„ì›€ ì£¼ì‹  ë°ì´í„°ë… ê´€ê³„ì ë¶„ë“¤ê³¼ ë©”ê°€ì¡´ ê¸°ìˆ íŒ€ ë¶„ë“¤ê»˜ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤! ğŸ™‡â€â™‚ï¸</p>

        </div>
        <div class="back-button">
            <a href="/blog">ëª©ë¡ìœ¼ë¡œ</a>
        </div>
        <div class="fb-comments" data-href="https://squarelab.co/blog/datadog-poc/" data-num-posts="4" data-width="100%"></div>
        <!--   <div class="side-bar">
    <div class="spacing"></div>
    <h5 class="title-category">CATEGORIES</h5>
    <p>
        <a href="/blog"> ALL</a>
        <span class="badge badge-theme pull-right"></span>
    </p>
    
    <p>
        <a href="/blog/#Engineering"> Engineering</a>
        <span class="badge badge-theme pull-right">13</span>
    </p>
    
    <p>
        <a href="/blog/#Design"> Design</a>
        <span class="badge badge-theme pull-right">4</span>
    </p>
    
    <p>
        <a href="/blog/#Interview"> Interview</a>
        <span class="badge badge-theme pull-right">4</span>
    </p>
    
    <p>
        <a href="/blog/#Travelog"> Travelog</a>
        <span class="badge badge-theme pull-right">1</span>
    </p>
    
    <p>
        <a href="/blog/#News"> News</a>
        <span class="badge badge-theme pull-right">2</span>
    </p>
    

    <div class="spacing"></div>
</div>

<div class="menu-wrap">
    <input type="checkbox" class="toggler">
    <div class="hamburger">
        <div></div>
    </div>
    <div class="menu">
        <div>
            <div>
                <a href="/index.html"><img src="/images/squarelab-bi-rec.png" width="32px" height="32px"
                                           class="menu-logo"></a>
                <p>
                    <a href="/blog">ALL</a>
                    <span class="badge badge-theme pull-right"></span>
                </p>
                
                <p>
                    <a href="/category/#Engineering"> Engineering</a>
                    <span class="badge badge-theme pull-right">13</span>
                </p>

                
                <p>
                    <a href="/category/#Design"> Design</a>
                    <span class="badge badge-theme pull-right">4</span>
                </p>

                
                <p>
                    <a href="/category/#Interview"> Interview</a>
                    <span class="badge badge-theme pull-right">4</span>
                </p>

                
                <p>
                    <a href="/category/#Travelog"> Travelog</a>
                    <span class="badge badge-theme pull-right">1</span>
                </p>

                
                <p>
                    <a href="/category/#News"> News</a>
                    <span class="badge badge-theme pull-right">2</span>
                </p>

                


            </div>
        </div>
    </div>
</div> 

  -->
    </div>
</div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v2.5&appId=1052544885096271";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script src="/js/locale-date.js"></script>
  <!-- Footer -->
<footer id="footer">
    <div class="inner">
        <ul class="copyright">
            <li>&copy;
                Square Lab
            </li>
            <li>
                (ì£¼)ìŠ¤í€˜ì–´ë© | ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„ì§€ë¡œ5ê¸¸ 19, í˜ëŸ¼íƒ€ì›Œ 24ì¸µ<br>
                ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ 151-87-00987 | í†µì‹ íŒë§¤ì—…ì‹ ê³ ë²ˆí˜¸ 2018-ì„œìš¸ì¤‘êµ¬-1626í˜¸<br>
                ì´ë©”ì¼ contact@squarelab.co | ëŒ€í‘œì ìœ¤ë¯¼
            </li>
        </ul>
        <div class="icons">
            <div class="icon"><a href="https://unsplash.com/@squarelab" target="_blank">
                <i class="ri-unsplash-fill"></i></a></div>
            <div class="icon"><a href="https://www.instagram.com/squarelab.co/" target="_blank">
                <i class="ri-instagram-line social"></i></a></div>
            <div class="icon"><a href="https://www.facebook.com/squarelab.co/" target="_blank">
                <i class="ri-facebook-circle-fill social"></i></a></div>
        </div>
    </div>
</footer>
  </body>
</html>