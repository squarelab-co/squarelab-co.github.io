<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="여행과 기술을 연결하고, 사용자와 여행을 이어주는 스퀘어랩만의 노하우를 확인해 보세요.">
  <meta name="msapplication-TileColor" content="#782bde">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="-kdxteMBSgKizw-6qHNm1-5nfxb7H6947J64jmjbBEg" />

  <meta property="og:site_name" content="Square Lab 블로그">
  <meta property="og:title" content="신입 개발자의 시스템 푸시 개발기">
  <meta property="og:description" content="입사한지 어느덧 8개월이 훌쩍 지나버린 지금. 신입 개발자는 무엇을 하고 있을까요? 입사 후 맡은 일 중 가장 큰 비중을 차지했던 시스템 푸시에 대해 소개해보려고...">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://squarelab.co/blog/system-push/">
  <meta property="og:image" content="https://squarelab.co/images/blog/system-push/cover.png">

  <title>신입 개발자의 시스템 푸시 개발기</title>

  <link rel="stylesheet" type="text/css" href="/css/blog.css">
  <link rel="stylesheet" type="text/css" href="/css/footer.css">
  <link rel="stylesheet" type="text/css" href="/css/zoom.css">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href='https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css" rel="stylesheet" >

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  출처: https://uxgjs.tistory.com/102 [UX 공작소]
  <script src="/js/zoom.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XPY973PH6D"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XPY973PH6D');
  </script>
</head>
  <body>
  <header id="blog-header" class="header">
    <div class="blog-header-container">
        <a href="/blog">
          <img src="/images/squarelab-bi-blog.png" width="200" class="bi-blog" alt="스퀘어랩 기술블로그 로고">
        </a>
        <a href="/"><i class="ri-home-4-line"></i></a>
    </div>
</header>
  <div class="blog-container">
    <div class="blog-top" style="background-image:url(/images/blog/system-push/cover.png); background-size: cover;" >
        <div class="overlay">
            <div class="title-container">
                <span class="category">Engineering</span>
                <h1 class="ctitle-top">신입 개발자의 시스템 푸시 개발기</h1>
                <div class="author">
                    <img class="img-author-2" src="/images/blog/author/joy.jpg">
                    <small class="small-top" >조이</small><small>|</small><small name="locale-date">Oct 13, 2023</small>
                </div>
            </div>
        </div>
    </div>
    <div class="blog-row">
        <div class="post">
            <p>입사한지 어느덧 8개월이 훌쩍 지나버린 지금. 신입 개발자는 무엇을 하고 있을까요?
입사 후 맡은 일 중 가장 큰 비중을 차지했던 시스템 푸시에 대해 소개해보려고 합니다.</p>

<hr />

<h2 id="시스템-푸시가-왜-필요해">시스템 푸시가 왜 필요해?</h2>

<p>우선 저희는 앱 푸시를 보내기 위해 Braze라는 플랫폼을 사용하고 있는데요. 기존에 발송되고 있는 푸시의 대부분이 마케팅이나 콘텐츠 팀원 분들이 Braze 대시보드에서 수신할 사용자, 푸시 타이틀 및 메세지, 푸시로 보낼 콘텐츠, 푸시 발송 시간 등을 발송할 때마다 매번 수동으로 설정해주고 있습니다.</p>

<p>하지만 플랫폼에서 제공하는 대시보드에서 푸시를 수신할 사용자들을 설정하는데에는 한계가 존재합니다. 푸시 수신 동의가 켜져있는 사용자에게만 보내는 것과 같은 단순한 조건은 큰 문제가 없겠지만 사용자의 행동 데이터에 기반한 조건이 복잡하게 설정되어야 하거나 플랫폼에는 없고 우리 서버에만 가지고 있는 데이터에 대한 조건이라면 이것은 더이상 대시보드에서 사람이 수동으로 설정할 수 없게 됩니다.</p>

<p><img src="/images/blog/system-push/direct-open-statistics.png" alt="direct-open-statistics" />
위 사진<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>에서 확인해볼 수 있듯이 다수 사용자보다는 세그먼트별로 분리된 사용자에게, 모두 같은 메세지보다는 동적인 메세지를 보냈을 때 푸시 오픈율이 더 높은 것을 볼 수 있습니다. 실제로 저 또한 다른 앱으로부터 받은 푸시들을 생각해봤을 때, 제가 최근에 관심있게 찾아봤던 것들이나 저에게만 주어지는 관련된 혜택이 푸시로 왔을 때 자주 눌러보는 것 같았습니다.</p>

<p>그래서 저희 서비스에도 사용자의 관심사와 행동에 알맞은 푸시를 발송하기 위해 <strong>타겟 사용자 선정, 푸시 콘텐츠, 발송까지 모두 시스템에서 자동화하는 시스템 푸시</strong>를 개발하게 되었습니다.</p>

<hr />

<h2 id="시스템-푸시-어떻게-만들었을까">시스템 푸시 어떻게 만들었을까?</h2>

<p>시스템 푸시를 발송하기 위한 과정을 크게 다섯 단계로 나눌 수 있는데요.</p>

<ol>
  <li>Braze 대시보드에서 발송할 푸시 캠페인 템플릿을 작성한다.</li>
  <li>조건에 맞는 푸시 타겟 사용자들과 콘텐츠를 가져온다.</li>
  <li>푸시 타이틀 및 메세지를 설정한다.</li>
  <li>푸시를 정해진 시간에 스케줄링한다.</li>
  <li>일정한 주기로 2~4를 반복할 수 있도록 cron을 돌린다.</li>
</ol>

<p>각 단계를 아래와 같은 예시 요구사항과 함께 설명드리도록 하겠습니다.</p>
<ul>
  <li>같은 호텔의 상세 페이지를 3번 이상 본 사용자에게 해당 호텔의 상세페이지로 랜딩</li>
  <li>매일 오후 5시에 발송</li>
</ul>

<h3 id="1-braze-대시보드에서-발송할-푸시-캠페인-템플릿을-작성한다">1. Braze 대시보드에서 발송할 푸시 캠페인 템플릿을 작성한다.</h3>
<p>API로 트리거될 캠페인을 만드는 과정입니다. 이 글에서는 캠페인 설정시 중요한 부분만 설명하며 캠페인을 만드는 자세한 과정은 Braze에서 제공하는 <a href="https://www.braze.com/docs/user_guide/engagement_tools/campaigns">가이드라인</a>을 참고하시면 됩니다.</p>

<p>liquid문법으로 <code class="highlighter-rouge">api_trigger_properties</code>를 설정하게 된다면 API로 트리거할 때 설정하고 싶은 값을 함께 넣어준다면 푸시 발송시에 설정한 값으로 발송되게 됩니다. 이처럼 title, message와 deep link 부분을 아래 사진과 같이 설정해줍니다.</p>
<div class="column-box">
    <img class="column-image" src="/images/blog/system-push/braze-01.png" alt="braze캠페인1" />
    <img class="column-image border" src="/images/blog/system-push/braze-02.png" alt="braze 캠페인2" />
</div>

<h3 id="2-조건에-맞는-푸시-타겟-사용자들과-콘텐츠를-가져온다">2. 조건에 맞는 푸시 타겟 사용자들과 콘텐츠를 가져온다.</h3>
<p>위에서 설정한 가정에 의하면 아래와 같습니다.</p>

<ul>
  <li>푸시 타겟 사용자 : 같은 호텔의 상세 페이지를 3번 이상 본 사용자들</li>
  <li>푸시 콘텐츠 : 사용자가 3번 이상 본 호텔의 상세페이지</li>
</ul>

<p>그렇다면 이제 이 정보를 빅쿼리에 적절한 쿼리를 보내 데이터를 가져온 후 적절한 형태로 가공합니다. (여기서 쿼리문이 중요한 것은 아니니 이 부분은 생략하겠습니다.)</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">targetData</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
  <span class="s">"조이"</span> <span class="n">to</span> <span class="nc">TargetInfo</span><span class="p">(</span>
      <span class="n">deviceId</span> <span class="p">=</span> <span class="s">"device_id"</span><span class="p">,</span>
      <span class="n">hotelName</span> <span class="p">=</span> <span class="s">"시그니엘 서울"</span><span class="p">,</span>
      <span class="n">deeplink</span> <span class="p">=</span> <span class="s">"deeplink url"</span>
  <span class="p">),</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="3-푸시-타이틀-및-메세지를-설정한다">3. 푸시 타이틀 및 메세지를 설정한다.</h3>

<p>푸시 타이틀에는 사용자 닉네임과, 푸시 메세지에는 각 사용자마다 3번 이상 본 호텔 이름이 들어간다고 가정해봅니다.</p>

<p>아래와 같이 2번에서 가져온 데이터로 각 사용자마다 title과 message, 랜딩할 deeplink까지 넣어 recipients를 만듭니다.
아래 예시 코드는 모든 타겟 사용자에게 같은 타이틀과 메세지를 설정하고 있지만, 유저마다 모두 다른 타이틀과 메세지를 설정할 수 있습니다.
<del>(예시에서 사용하는 푸시 타이틀과 메세지는 개발자의 머리에서 나온 문구로, 예시일 뿐입니다.)</del></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">recipients</span> <span class="p">=</span> <span class="n">targetData</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="n">targetInfo</span><span class="p">)</span> <span class="p">-&gt;</span>
  <span class="nc">BrazeCampaignRecipient</span><span class="p">(</span>
      <span class="n">externalUserId</span> <span class="p">=</span> <span class="n">targetInfo</span><span class="p">.</span><span class="n">deviceId</span><span class="p">,</span>
      <span class="nc">BrazeCampaignTriggerProperties</span><span class="p">(</span>
          <span class="n">title</span> <span class="p">=</span> <span class="s">"똑똑✊ ${userName}님"</span><span class="p">,</span>
          <span class="n">message</span> <span class="p">=</span> <span class="s">"${targetInfo.hotelName}에 관심이 있으시군요"</span><span class="p">,</span>
          <span class="n">deepLink</span> <span class="p">=</span> <span class="n">targetInfo</span><span class="p">.</span><span class="n">deeplink</span>
      <span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="4-푸시를-정해진-시간에-스케줄링-한다">4. 푸시를 정해진 시간에 스케줄링 한다.</h3>

<p>위에서 말씀드린 Braze 플랫폼은 다양한 API를 제공하고 있는데, 여기서 사용할 API는 푸시를 특정한 시간에 보낼 수 있도록 하는 푸시 스케줄링 API를 사용할 것입니다. 자세한 API 스펙은 <a href="https://www.braze.com/docs/api/endpoints/messaging/schedule_messages/post_schedule_triggered_campaigns/">여기</a>서 확인하시면 됩니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">brazeApi</span><span class="p">.</span><span class="nf">postCampaignsSchedule</span><span class="p">(</span>
  <span class="n">requestBody</span> <span class="p">=</span> <span class="nc">CampaignsScheduleRequest</span><span class="p">(</span>
      <span class="n">schedule</span> <span class="p">=</span> <span class="nc">BrazeCampaignSchedule</span><span class="p">(</span><span class="s">"2023-10-14T17:00:00+09:00"</span><span class="p">),</span>
      <span class="n">campaignId</span> <span class="p">=</span> <span class="n">campaignId</span><span class="p">,</span>
      <span class="n">recipients</span> <span class="p">=</span> <span class="n">recipients</span><span class="p">,</span>  <span class="c1">// 3번에서 만든 recipients</span>
      <span class="n">broadcast</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>
<p>위와 같이 스케줄링을 한 후 시간이 되면 아래와 같이 푸시가 성공적으로 전송된 것을 볼 수 있습니다.
<img src="/images/blog/system-push/example-push.jpeg" alt="예시 푸시" /></p>

<h3 id="5-일정한-주기로-24를-반복할-수-있도록-cron을-돌린다">5. 일정한 주기로 2~4를 반복할 수 있도록 cron을 돌린다.</h3>
<p>매일 오후 5시에 보내야하므로 매일 오후 5시 전에 돌 수 있도록 cron을 설정합니다.
2~4의 로직을 반복하고 4번의 schedule에 들어가는 푸시 스케줄링 시간만 매일 오후 5시로 설정하면 됩니다.</p>

<p>이렇게 하면 시스템 푸시 개발이 끝났습니다! 이제 위에서 만든 시스템 푸시는 타겟 사용자들에게, 적절한 콘텐츠와 함께 설정한 시간에 자동으로 발송되게 됩니다.</p>

<hr />

<h2 id="결과는">결과는?</h2>
<p>기존에 다수 사용자에게 같은 내용으로 보내는 푸시의 오픈율은 약 2%인 데에 반해, 시스템 푸시의 오픈율은 모수와 콘텐츠 종류에 따라 약간의 차이는 있지만 평균적으로 <strong>약 10% 정도</strong>의 오픈율을 볼 수 있었습니다.</p>

<hr />

<h2 id="마무리">마무리</h2>
<p>아무래도 푸시는 수신한 시점에 가장 많이 열어보기도 하고, 잘못 발송되었을 때 이미 발송된 푸시를 고칠 수 없다보니 제일 처음 만든 시스템 푸시가 실제로 사용자에게 발송되던 시점에는 ‘혹시나 잘못 가면 어쩌지.. 잘 발송되었겠지?🫣’하면서 지켜봤었습니다. 이후에 성공적으로 발송된 것을 확인하고 오픈 수가 올라가는 것을 봤을 때는 정말 뿌듯했었습니다. 사실 아직도 새롭게 만든 시스템 푸시가 사용자들에게 발송될 때면 두근두근거립니다..ㅎㅎ</p>

<p>처음 시스템 푸시를 개발하게 된 건 입사하고 약 3개월쯤이었던 것 같은데요. 그전까지는 코드를 이해하고 조그마한 이슈들을 고치는데 대부분 시간을 보냈었기에 시스템 푸시 개발은 조금은 막막했었던 것 같습니다. 그래도 많은 분의 도움과 그 과정에서 받는 코드 리뷰로 하나둘씩 제가 의도한 대로 코드가 작동하면서 성공적으로 시스템 푸시 개발을 마칠 수 있었던 것 같습니다! 이 글이 시스템 푸시 도입을 고민하거나 개발하고 계시는 분들께 도움이 되었으면 좋겠습니다.</p>

<h2 id="각주">각주</h2>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p><a href="https://www.businessofapps.com/marketplace/push-notifications/research/push-notifications-statistics/">push notifications statistics</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        </div>
        <div class="back-button">
            <a href="/blog">목록으로</a>
        </div>
        <div class="fb-comments" data-href="https://squarelab.co/blog/system-push/" data-num-posts="4" data-width="100%"></div>
        <!--   <div class="side-bar">
    <div class="spacing"></div>
    <h5 class="title-category">CATEGORIES</h5>
    <p>
        <a href="/blog"> ALL</a>
        <span class="badge badge-theme pull-right"></span>
    </p>
    
    <p>
        <a href="/blog/#Engineering"> Engineering</a>
        <span class="badge badge-theme pull-right">13</span>
    </p>
    
    <p>
        <a href="/blog/#Design"> Design</a>
        <span class="badge badge-theme pull-right">4</span>
    </p>
    
    <p>
        <a href="/blog/#Interview"> Interview</a>
        <span class="badge badge-theme pull-right">4</span>
    </p>
    
    <p>
        <a href="/blog/#Travelog"> Travelog</a>
        <span class="badge badge-theme pull-right">1</span>
    </p>
    
    <p>
        <a href="/blog/#News"> News</a>
        <span class="badge badge-theme pull-right">2</span>
    </p>
    

    <div class="spacing"></div>
</div>

<div class="menu-wrap">
    <input type="checkbox" class="toggler">
    <div class="hamburger">
        <div></div>
    </div>
    <div class="menu">
        <div>
            <div>
                <a href="/index.html"><img src="/images/squarelab-bi-rec.png" width="32px" height="32px"
                                           class="menu-logo"></a>
                <p>
                    <a href="/blog">ALL</a>
                    <span class="badge badge-theme pull-right"></span>
                </p>
                
                <p>
                    <a href="/category/#Engineering"> Engineering</a>
                    <span class="badge badge-theme pull-right">13</span>
                </p>

                
                <p>
                    <a href="/category/#Design"> Design</a>
                    <span class="badge badge-theme pull-right">4</span>
                </p>

                
                <p>
                    <a href="/category/#Interview"> Interview</a>
                    <span class="badge badge-theme pull-right">4</span>
                </p>

                
                <p>
                    <a href="/category/#Travelog"> Travelog</a>
                    <span class="badge badge-theme pull-right">1</span>
                </p>

                
                <p>
                    <a href="/category/#News"> News</a>
                    <span class="badge badge-theme pull-right">2</span>
                </p>

                


            </div>
        </div>
    </div>
</div> 

  -->
    </div>
</div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v2.5&appId=1052544885096271";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script src="/js/locale-date.js"></script>
  <!-- Footer -->
<footer id="footer">
    <div class="inner">
        <ul class="copyright">
            <li>&copy;
                Square Lab
            </li>
            <li>
                (주)스퀘어랩 | 서울특별시 중구 을지로5길 19, 페럼타워 24층<br>
                사업자등록번호 151-87-00987 | 통신판매업신고번호 2018-서울중구-1626호<br>
                이메일 contact@squarelab.co | 대표자 윤민
            </li>
        </ul>
        <div class="icons">
            <div class="icon"><a href="https://unsplash.com/@squarelab" target="_blank">
                <i class="ri-unsplash-fill"></i></a></div>
            <div class="icon"><a href="https://www.instagram.com/squarelab.co/" target="_blank">
                <i class="ri-instagram-line social"></i></a></div>
            <div class="icon"><a href="https://www.facebook.com/squarelab.co/" target="_blank">
                <i class="ri-facebook-circle-fill social"></i></a></div>
        </div>
    </div>
</footer>
  </body>
</html>